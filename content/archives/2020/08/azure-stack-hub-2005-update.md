---
title: Azure Stack Hub 2005 Update
author: kongou_ae
date: 2020-08-25
url: /archives/2020/08/azure-stack-hub-2005-update
categories:
  - azurestack
---

## はじめに

Azure Stack Hub 2005 Update が配信されました。前回の2002 Update の配信が2020年3月でしたので、5か月ぶりのアップデートになります。原則として Azure Stack Hub のアップデートは毎月配信されるのですが、いろいろあったのか配信が伸びました。

本エントリでは、気になった 2005 Update での新機能や改善をまとめます。

## アップデートポリシの変更

COVID-19 に伴う運用への影響を鑑みて、サポートポリシが「現行と2世代前まで」から「現行と3世代前まで」に変更になっていました。このポリシが「現行と2世代前まで」に戻ります。現時点では3世代前の1908 Update がサポート対象になっていますが、9/25以降は1908 Update がサポート切れにもどり、2005 Update と 2002 Update、そして1910 Update だけがサポート対象になります。1910 Update をお使いの方は急いでアップデートしましょう。

## GPU VM のサポート

次の GPU 搭載 VM を利用できるようになりました。利用にあたっては、GPU 搭載タイプの Azure Stack Hub とプレビュープログラムへの参加が必要です。

- NCv3 (Nvidia V100)
- NVv4 (AMD MI25)
- NCas_v4 (NVIDIA T4) VM sizes. 

GPU VM のサポートは Ignite 2019 で発表になった機能です。ついに利用可能になりました。ただし、Azure Stack Hub 上の GPU VM には、「ハードウェア障害対応やアップデートの適用中に利用できなくなり利用再開のために手動操作が必要」という制約があるようなので注意が必要です。

参考：[https://docs.microsoft.com/ja-jp/azure-stack/user/gpu-vms-about?view=azs-2005#patch-and-update-fru-behavior-of-vms](修正プログラム、更新プログラムの適用時、および FRU の際の VM の動作)

> GPU VM では、修正プログラムと更新プログラム (PnU) の適用時や、Azure Stack Hub のハードウェア交換 (FRU) などの操作中にダウンタイムが発生することがあります。

## 自動修復機能

自己修復機能が追加されたようです。これまでの Azure Stack Hub は、検知した直後にクローズになるアラートがでることがまれにありました。これらのアラートが出てこなくなるとアラートが減って運用が楽になりますし、Microsoft のサポート担当に問い合わせる件数も減るでしょう。Azure Stack Hub オペレータとサポート担当の両方が幸せになる機能ですね。

> このリリースには、エラーを検出し、影響を評価して、システムの問題を安全に軽減する自律復旧機能を有効にする新機能が用意されています。 この機能により、Microsoft は手動による介入なしでシステムの可用性を向上させることを目指しています。 

## ポータルからのログ取得が SMB をサポート

管理ポータルからボタン一つで SMB ファイル共有にログをとれるようになりました。Azure Stack Hub には管理ポータルからボタン一つでログをとれる機能があります。ただし、この機能は Microsoft が管理するストレージアカウントにログをアップロードするためのものでした。そのため、便利な機能ではあるものの、インターネットに接続していない Disconnected な Azure Stack Hub ではこの機能を利用できませんでした。今回の Update によって、Disconnected な Azure Stack Hub であってもこの機能の恩恵を得られるようになりました。

{{< figure src="/images/2020/2020-0824-001.png" title="SMB ファイル共有の設定画面" >}}

## アップデートの所要時間の削減

Ignite 2019 で開発中と発表された機能がリリースされました。2005 Update 以降の Azure Stack Hub では、アップデートにかかる時間が大幅に短縮されます。例えば4台構成だと、15時間から42時間だった見込み時間が、13時間から20時間に短縮されます。アップデートにかかる時間が短くなると、ユーザにアナウンスするメンテナンス時間が短くできますし、アップデート中のハードウェア障害でノードが2台同時に停止してしまうリスクも減らせます。ありがたいアップデートです。

## まとめ

Azure Stack Hub 2005 でリリースされた新機能や改善の中で気になるものをまとめました。アップデート時間がぐっと短くなったのがとてもうれしいですね。また、Ignite 2019 で開発中と発表された機能がリリースされたのが印象的です。Ignite 2019 で開発中と発表された機能の中で未リリースなものは次の通りです。いつになるやら。

- マルチスケールユニット（開発中）
- インフラのコンテナ化（開発中）
- Instance Metadata（開発中）

