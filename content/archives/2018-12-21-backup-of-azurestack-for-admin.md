---
title: Azure Stack をバックアップする（管理者向け）
author: kongou_ae
date: 2018-12-21
url: /archives/2018-12-21-backup-of-azurestack-for-admin
categories:
  - azurestack
---

##  はじめに

本エントリーは[Microsoft Azure Stack Advent Calendar 2018](https://qiita.com/advent-calendar/2018/azure-stack)の21日目です。

本日のエントリでは Azure Stack のバックアップをまとめます。本日のエントリの主題は、管理者が取得すべきバックアップです。利用者が取得すべきバックアップは、明日のエントリの題材です。

なお、PaaS のバックアップは本エントリの対象外です。私が PaaS のバックアップを説明できるほど PaaS を使いこなしていないからです。

## バックアップされるもの、されないもの

Asure Stack には、管理者向けにバックアップの機能が提供されています。管理者向けバックアップに含まれるものは次の通りです。

参考

含まれないものは次のとおりです。

参考

あくまでも、管理者向けのバックアップは、管理者が基盤を再構築するためのバックアップです。利用者が作成したものはバックアップされません。したがって、バックアップからリストアすると、利用者が Azure Stack に作成したリソースは消失します。


## バックアップの保存先

Azure Stack は、バックアップファイルを SMB のファイル共有に保存します。一回あたりのバックアップファイルのサイズは約10GBです。Microsoft は、1日2回バックアップを取得して七日間保存することを推奨していますので、約140GB の容量を持ったファイル共有が必要です。バックアップの取得頻度または保存期間を短くすれば、ファイル共有の容量も減らせます。


参考


## 管理者がすべきこと

当然ながら、万が一の全損にそなえて、管理者向けバックアップを定期的に取得しなければなりません。これと同じくらい大事なことが、利用者に対して利用者がバックアップすべき範囲を説明することです。

管理者向けのバックアップには、利用者が保存したデータはもちろんのこと、テナントが作成したリソースの構成情報（VM のサイズや Disk本数、NIC のIP アドレスなど、Get-AzureRMResourceで取得できる情報）も含まれていません。Azure Stack をご利用いただく前に、データのバックアップとリソースの構成情報の両方を定期的に保存する必要があることを説明しましょう。

## バックアップのとりかた

GUI と PowerShell のどちらでも、バックアップを設定できます。ただし、GUI の場合であっても 一部の作業にPowerShell が必要なので、今回は PowerShell を利用します。


## リストアのしかた

PowerShell でリストアします。バックアップには利用者の構成情報やデータが含まれていないので、リストアすると綺麗になるはずです。このオペレーションを実施しなければならないシナリオが知りたいです。


## まとめ

本日のエントリでは、管理者向けのAzure Stack のバックアップについてまとめました。技術的な設定方法よりも、利用者が作ったリソースと利用者が保存したデータの保護責任が利用者にあることを説明することが重要です。

