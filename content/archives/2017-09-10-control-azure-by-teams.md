---
title: Microsoft Teamsを使ってAzureの仮想マシンを起動・停止する
author: kongou_ae

date: 2017-09-10
url: /archives/2017-09-10-control-azure-by-teams
categories:
  - Azure

---

## はじめに

Microsoft Teamsで利用できるBOTを探していたら、[AzureBot](https://microsoft.github.io/AzureBot/)を見つけました。AzureBotは次の作業をサポートしています。実際に試してみました。

- 仮想マシンの起動と停止
- Runbookの実行

## インストール

「アプリ」からインストールします。BOTを招待できるのは1:1チャットのみです。チームには招待できません。

{{<img src="./../../images/2017-09-10-001.png">}}

## できること

話しかけるとBotが自分のできることを説明してくれます。親切です。困ったら「help」と話しかけましょう。できることを説明してくれます。

{{<img src="./../../images/2017-09-10-002.png">}}

## 認証

「loginしろ」と言われるのでloginします。BOTからのリプライに含まれる「Authentication Required」をクリックすると、認証コードが表示されます。このコードをBOTにリプライします。リプライする際には、認証コードを手で入力しましょう。コピー&ペーストしたら認証エラーになりました。

{{<img src="./../../images/2017-09-10-003.png">}}

{{<img src="./../../images/2017-09-10-004.png">}}

認証に成功すると、AzureBotが挨拶してくれます。

{{<img src="./../../images/2017-09-10-005.png">}}

## VMを操作する

### VMの一覧を表示する

それっぽいコマンドを発言すると、VMの一覧を表示してくれます。

{{<img src="./../../images/2017-09-10-006.png">}}

### VMを停止する

VMを停止するまでに必要なやりとりがよくできています。LUISを使っているからなのか、いろいろな言い回しを解釈して動作します。自分でBOTを作る時の参考にしたい。

1. 人：それっぽいコマンドを入力する
1. BOT：入力内容からユーザがVMを停止したいと解釈して、どのVMを停止したいのかを番号で聞き返す
1. 人：停止したいVMの番号を入力する
1. BOT：停止対象の仮想マシンの情報を伝えて、停止に同意を求める
1. 人：停止に同意する
1. BOT:停止処理を開始する

{{<img src="./../../images/2017-09-10-007.png">}}

VM名を指定して発言すると、上記やりとりの4（停止の同意を求める）から始まります。

{{<img src="./../../images/2017-09-10-009.png">}}

### VMを起動する

VMの停止と同じ流れでVMを起動できます。

{{<img src="./../../images/2017-09-10-008.png">}}

## 感想

今の業務では検証用VMを高頻度で起動・停止しています。ポータルにログインしなくてもVMを起動・停止できるのは便利なので、業務で使ってみます。